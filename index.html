<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flappy Bird - Premium Version</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            overflow: hidden;
        }
        
        .game-container {
            width: 360px;
            height: 640px;
            position: relative;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5);
            background: #0a0e29;
        }
        
        canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        .screen {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            background: rgba(10, 14, 41, 0.95);
            z-index: 10;
            transition: opacity 0.5s;
            padding: 20px;
            overflow-y: auto;
        }
        
        .hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
            width: 100%;
        }
        
        h1 {
            font-size: 32px;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #FFD700, #FFA500);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 2px 10px rgba(255, 215, 0, 0.3);
        }
        
        h2 {
            font-size: 24px;
            margin: 15px 0;
            color: #FFD700;
            text-align: center;
        }
        
        .subtitle {
            font-size: 18px;
            color: #a0a0c0;
            margin-bottom: 25px;
            text-align: center;
        }
        
        .categories {
            display: flex;
            justify-content: space-around;
            width: 100%;
            margin: 20px 0;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50px;
            padding: 8px;
        }
        
        .category {
            padding: 10px 15px;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            text-align: center;
            flex: 1;
            margin: 0 5px;
        }
        
        .category.active {
            background: linear-gradient(45deg, #FF5722, #FF9800);
            box-shadow: 0 4px 15px rgba(255, 87, 34, 0.4);
        }
        
        .items-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            width: 100%;
            margin-top: 20px;
        }
        
        .item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 15px 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            border: 2px solid transparent;
            min-height: 100px;
            overflow: hidden;
        }
        
        .item:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .item.selected {
            border-color: #FFD700;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
            animation: glow 2s infinite;
        }
        
        .item.free {
            border-color: #4CAF50;
        }
        
        .item.premium {
            border-color: #FFD700;
            background: linear-gradient(45deg, rgba(255,215,0,0.1), rgba(255,165,0,0.1));
            animation: premiumGlow 3s infinite;
        }
        
        .item.owned {
            border-color: #4CAF50;
            background: linear-gradient(45deg, rgba(76,175,80,0.1), rgba(76,175,80,0.2));
        }
        
        .item-color {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-bottom: 10px;
            border: 2px solid rgba(255,255,255,0.3);
            box-shadow: 0 0 10px rgba(255,255,255,0.2);
        }
        
        .character-preview {
            width: 50px;
            height: 40px;
            margin-bottom: 8px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .character-bird {
            width: 30px;
            height: 20px;
            background: #FFD700;
            border-radius: 50%;
            position: relative;
        }
        
        .character-bird::after {
            content: '';
            position: absolute;
            right: -8px;
            top: 7px;
            width: 12px;
            height: 6px;
            background: #FF5722;
            clip-path: polygon(0 0, 100% 50%, 0 100%);
        }
        
        .character-salmon {
            width: 35px;
            height: 15px;
            background: #FF8C69;
            border-radius: 20px;
            position: relative;
        }
        
        .character-salmon::after {
            content: '';
            position: absolute;
            left: -8px;
            top: 3px;
            width: 10px;
            height: 10px;
            background: #FF8C69;
            clip-path: polygon(100% 0, 100% 100%, 0 50%);
        }
        
        .character-fish {
            width: 30px;
            height: 15px;
            background: #87CEEB;
            border-radius: 15px;
            position: relative;
        }
        
        .character-fish::after {
            content: '';
            position: absolute;
            left: -6px;
            top: 3px;
            width: 8px;
            height: 8px;
            background: #87CEEB;
            clip-path: polygon(100% 0, 100% 100%, 0 50%);
        }
        
        .character-santa {
            width: 25px;
            height: 25px;
            background: #8B4513;
            border-radius: 50%;
            position: relative;
        }
        
        .character-santa::before {
            content: '';
            position: absolute;
            top: -3px;
            left: 5px;
            width: 15px;
            height: 8px;
            background: red;
            border-radius: 10px 10px 0 0;
        }
        
        .item-name {
            font-size: 14px;
            text-align: center;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .item-price {
            font-size: 14px;
            font-weight: bold;
            display: flex;
            align-items: center;
        }
        
        .item-price.free {
            color: #4CAF50;
        }
        
        .coins-icon {
            width: 16px;
            height: 16px;
            margin-right: 5px;
            filter: drop-shadow(0 0 3px gold);
        }
        
        .divider {
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, transparent, #FFD700, transparent);
            margin: 20px 0;
        }
        
        button {
            background: linear-gradient(45deg, #FF5722, #FF9800);
            color: white;
            border: none;
            padding: 14px 30px;
            font-size: 18px;
            border-radius: 50px;
            cursor: pointer;
            margin: 10px 0;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(255, 87, 34, 0.4);
            font-weight: bold;
            width: 100%;
            max-width: 280px;
        }
        
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 20px rgba(255, 87, 34, 0.6);
        }
        
        button:active {
            transform: translateY(1px);
        }
        
        .premium-btn {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            color: #333;
            animation: buttonGlow 2s infinite;
        }
        
        .shop-btn {
            background: linear-gradient(45deg, #2196F3, #21CBF3);
        }
        
        .back-btn {
            background: linear-gradient(45deg, #9C27B0, #E91E63);
            margin-top: 20px;
        }
        
        .coins-display {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 18px;
            font-weight: bold;
            z-index: 5;
            display: flex;
            align-items: center;
            border: 1px solid #FFD700;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
        }
        
        .coins-display img {
            width: 20px;
            height: 20px;
            margin-right: 8px;
            animation: coinSpin 3s infinite;
        }
        
        .score-display {
            position: absolute;
            top: 20px;
            left: 20px;
            font-size: 24px;
            font-weight: bold;
            z-index: 5;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            background: rgba(0, 0, 0, 0.5);
            padding: 5px 15px;
            border-radius: 20px;
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .game-over {
            text-align: center;
        }
        
        .game-over h2 {
            color: #FF5252;
            font-size: 32px;
            text-shadow: 0 0 10px rgba(255,82,82,0.5);
        }
        
        .final-score {
            font-size: 24px;
            margin: 10px 0;
        }
        
        .coins-earned {
            font-size: 20px;
            margin: 10px 0;
            color: #FFD700;
            text-shadow: 0 0 5px rgba(255,215,0,0.5);
        }
        
        .locked {
            opacity: 0.7;
            position: relative;
        }
        
        .locked::after {
            content: "ðŸ”’";
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 16px;
            text-shadow: 0 0 5px black;
        }
        
        .instructions {
            text-align: center;
            margin: 15px 0;
            color: #a0a0c0;
            font-size: 16px;
        }
        
        .background-preview {
            width: 60px;
            height: 40px;
            border-radius: 8px;
            margin-bottom: 8px;
            border: 2px solid rgba(255,255,255,0.3);
            position: relative;
            overflow: hidden;
        }
        
        .premium-badge {
            position: absolute;
            top: 2px;
            right: 2px;
            background: gold;
            color: black;
            font-size: 8px;
            padding: 1px 3px;
            border-radius: 3px;
            font-weight: bold;
        }
        
        .owned-badge {
            position: absolute;
            top: 2px;
            left: 2px;
            background: #4CAF50;
            color: white;
            font-size: 8px;
            padding: 1px 3px;
            border-radius: 3px;
            font-weight: bold;
        }
        
        .purchase-effect {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(76, 175, 80, 0.9);
            color: white;
            padding: 20px 40px;
            border-radius: 15px;
            font-size: 24px;
            font-weight: bold;
            z-index: 100;
            animation: purchasePopup 2s forwards;
            box-shadow: 0 0 30px rgba(76, 175, 80, 0.7);
            border: 3px solid #4CAF50;
        }
        
        .coin-animation {
            position: absolute;
            font-size: 16px;
            color: #FFD700;
            font-weight: bold;
            z-index: 10;
            animation: coinFloat 1.5s ease-out forwards;
            text-shadow: 0 0 5px rgba(255,215,0,0.8);
        }
        
        /* Animations */
        @keyframes glow {
            0%, 100% { box-shadow: 0 0 10px rgba(255,215,0,0.5); }
            50% { box-shadow: 0 0 20px rgba(255,215,0,0.8), 0 0 30px rgba(255,215,0,0.6); }
        }
        
        @keyframes premiumGlow {
            0%, 100% { 
                box-shadow: 0 0 15px rgba(255,215,0,0.5);
                transform: scale(1);
            }
            50% { 
                box-shadow: 0 0 25px rgba(255,215,0,0.8), 0 0 35px rgba(255,215,0,0.6);
                transform: scale(1.02);
            }
        }
        
        @keyframes buttonGlow {
            0%, 100% { box-shadow: 0 4px 15px rgba(255,215,0,0.4); }
            50% { box-shadow: 0 4px 20px rgba(255,215,0,0.8), 0 4px 30px rgba(255,215,0,0.6); }
        }
        
        @keyframes coinSpin {
            0% { transform: rotateY(0deg); }
            100% { transform: rotateY(360deg); }
        }
        
        @keyframes purchasePopup {
            0% { 
                opacity: 0; 
                transform: translate(-50%, -50%) scale(0.5); 
            }
            20% { 
                opacity: 1; 
                transform: translate(-50%, -50%) scale(1.1); 
            }
            40% { 
                transform: translate(-50%, -50%) scale(1); 
            }
            80% { 
                opacity: 1; 
                transform: translate(-50%, -50%) scale(1); 
            }
            100% { 
                opacity: 0; 
                transform: translate(-50%, -50%) scale(0.8); 
            }
        }
        
        @keyframes coinFloat {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            50% {
                opacity: 0.8;
                transform: translateY(-30px) scale(1.2);
            }
            100% {
                opacity: 0;
                transform: translateY(-60px) scale(1.5);
            }
        }
        
        @keyframes coinCount {
            0% { transform: scale(1); }
            50% { transform: scale(1.3); }
            100% { transform: scale(1); }
        }
        
        .difficulty-selector {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            width: 100%;
            max-width: 280px;
        }
        
        .difficulty-btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 10px;
            background: rgba(255,255,255,0.1);
            color: white;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .difficulty-btn.active {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            box-shadow: 0 2px 10px rgba(76,175,80,0.4);
        }
        
        .difficulty-btn.easy { border-left: 4px solid #4CAF50; }
        .difficulty-btn.medium { border-left: 4px solid #FF9800; }
        .difficulty-btn.hard { border-left: 4px solid #F44336; }
    </style>
</head>
<body>
    <div class="game-container">
        <canvas id="gameCanvas"></canvas>
        
        <div class="coins-display">
            <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIj48cGF0aCBmaWxsPSIjRkZENzAwIiBkPSJNNDUyIDg0SDYwQzI2LjkgODQgMCAxMTAuOSAwIDE0NHYyMjRjMCAzMy4xIDI2LjkgNjAgNjAgNjBoMzkyYzMzLjEgMCA2MC0yNi45IDYwLTYwVjE0NGMwLTMzLjEtMjYuOS02MC02MC02MHpNMjU2IDQwOGMtNjYuMiAwLTEyMC01My44LTEyMC0xMjBzNTMuOC0xMjAgMTIwLTEyMCAxMjAgNTMuOCAxMjAgMTIwLTUzLjggMTIwLTEyMCAxMjB6bTAtMjE2Yy01MyAwLTk2IDQzLTk2IDk2czQzIDk2IDk2IDk2IDk2LTQzIDk2LTk2LTQzLTk2LTk2LTk2em0wIDE2MGMtMzUuMyAwLTY0LTI4LjctNjQtNjRzMjguNy02NCA2NC02NCA2NCAyOC43IDY0IDY0LTI4LjcgNjQtNjQgNjR6Ii8+PC9zdmc+" alt="Coin">
            <span id="coinsCount">1500</span>
        </div>
        
        <div id="startScreen" class="screen">
            <div class="header">
                <h1>Flappy Bird</h1>
                <div class="subtitle">Premium Version</div>
            </div>
            
            <div class="difficulty-selector">
                <button class="difficulty-btn easy active" data-difficulty="easy">Easy</button>
                <button class="difficulty-btn medium" data-difficulty="medium">Medium</button>
                <button class="difficulty-btn hard" data-difficulty="hard">Hard</button>
            </div>
            
            <button id="startBtn" class="premium-btn">Start Game</button>
            <button id="shopBtn" class="shop-btn">Premium Shop</button>
            <div class="instructions">Tap or press Space to flap</div>
        </div>
        
        <div id="shopScreen" class="screen hidden">
            <div class="header">
                <h1>Premium Shop</h1>
            </div>
            
            <div class="categories">
                <div class="category active" data-category="bird">Bird</div>
                <div class="category" data-category="pipe">Pipe</div>
                <div class="category" data-category="background">Background</div>
                <div class="category" data-category="character">Character</div>
            </div>
            
            <div class="divider"></div>
            
            <h2 id="shopCategoryTitle">Bird Colors</h2>
            
            <div class="items-grid" id="itemsContainer">
                <!-- Items will be loaded here dynamically -->
            </div>
            
            <button id="backBtn" class="back-btn">Back to Menu</button>
        </div>
        
        <div id="gameOverScreen" class="screen hidden">
            <div class="game-over">
                <h2>Game Over!</h2>
                <div class="final-score">Score: <span id="finalScore">0</span></div>
                <div class="coins-earned">You earned: <span id="coinsEarned">0</span> coins</div>
                <button id="restartBtn">Play Again</button>
                <button id="menuBtn">Menu</button>
            </div>
        </div>
        
        <div class="score-display" id="scoreDisplay">Score: 0</div>
    </div>

    <script>
        // Game variables
        let canvas, ctx;
        let bird = { x: 50, y: 150, width: 34, height: 24, velocity: 0, gravity: 0.5, jump: -8 };
        let pipes = [];
        let score = 0;
        let coins = 1500;
        let gameRunning = false;
        let gameSpeed = 2;
        let pipeGap = 180;
        let pipeWidth = 60;
        let pipeInterval = 150;
        let frameCount = 0;
        let currentDifficulty = 'easy';
        let coinsToAdd = 0;
        let coinAnimationTimer = 0;
        
        // Track owned items
        let ownedItems = {
            bird: ['bird1'],
            pipe: ['pipe1'],
            background: ['background1'],
            character: ['character1']
        };
        
        // Selected items
        let selectedItems = {
            bird: 'bird1',
            pipe: 'pipe1',
            background: 'background1',
            character: 'character1'
        };
        
        // Shop items data
        const shopItems = {
            bird: [
                { id: 'bird1', name: 'Classic', cost: 0, color: '#FFD700', premium: false },
                { id: 'bird2', name: 'Ruby Red', cost: 100, color: '#FF5252', premium: false },
                { id: 'bird3', name: 'Ocean Blue', cost: 150, color: '#2196F3', premium: false },
                { id: 'bird4', name: 'Emerald', cost: 200, color: '#4CAF50', premium: false },
                { id: 'bird5', name: 'Royal Purple', cost: 250, color: '#9C27B0', premium: false },
                { id: 'bird6', name: 'Sunset Orange', cost: 300, color: '#FF9800', premium: false },
                { id: 'bird7', name: 'Sky Cyan', cost: 350, color: '#00BCD4', premium: false },
                { id: 'bird8', name: 'Pink Blossom', cost: 400, color: '#E91E63', premium: false },
                { id: 'bird9', name: 'Deep Teal', cost: 450, color: '#009688', premium: false },
                { id: 'bird10', name: 'Lime Fresh', cost: 500, color: '#CDDC39', premium: false },
                { id: 'bird11', name: 'Golden Amber', cost: 550, color: '#FFC107', premium: false },
                { id: 'bird12', name: 'Rainbow', cost: 800, color: 'linear-gradient(45deg, #FF5252, #FFD700, #4CAF50)', premium: true }
            ],
            pipe: [
                { id: 'pipe1', name: 'Classic', cost: 0, color: '#4CAF50', premium: false },
                { id: 'pipe2', name: 'Crimson', cost: 100, color: '#FF5252', premium: false },
                { id: 'pipe3', name: 'Azure', cost: 150, color: '#2196F3', premium: false },
                { id: 'pipe4', name: 'Tangerine', cost: 200, color: '#FF9800', premium: false },
                { id: 'pipe5', name: 'Violet', cost: 250, color: '#9C27B0', premium: false },
                { id: 'pipe6', name: 'Turquoise', cost: 300, color: '#00BCD4', premium: false },
                { id: 'pipe7', name: 'Rose', cost: 350, color: '#E91E63', premium: false },
                { id: 'pipe8', name: 'Jade', cost: 400, color: '#009688', premium: false },
                { id: 'pipe9', name: 'Lemon', cost: 450, color: '#CDDC39', premium: false },
                { id: 'pipe10', name: 'Gold', cost: 500, color: '#FFC107', premium: false },
                { id: 'pipe11', name: 'Chocolate', cost: 550, color: '#795548', premium: false },
                { id: 'pipe12', name: 'Galaxy', cost: 800, color: 'linear-gradient(45deg, #FF5252, #FFD700, #4CAF50)', premium: true }
            ],
            background: [
                { 
                    id: 'background1', 
                    name: 'Sunny Day', 
                    cost: 0, 
                    type: 'sky',
                    colors: ['#70c5ce', '#87CEEB'],
                    premium: false 
                },
                { 
                    id: 'background2', 
                    name: 'Green Field', 
                    cost: 300, 
                    type: 'field',
                    colors: ['#87CEEB', '#7CFC00'],
                    premium: false 
                },
                { 
                    id: 'background3', 
                    name: 'Starry Night', 
                    cost: 500, 
                    type: 'night',
                    colors: ['#0f1a30', '#1a237e'],
                    premium: false 
                },
                { 
                    id: 'background4', 
                    name: 'Spooky Halloween', 
                    cost: 500, 
                    type: 'halloween',
                    colors: ['#4B0082', '#8B0000'],
                    premium: false 
                },
                { 
                    id: 'background5', 
                    name: 'Merry Christmas', 
                    cost: 1500, 
                    type: 'christmas',
                    colors: ['#1E90FF', '#228B22'],
                    premium: true 
                },
                { 
                    id: 'background6', 
                    name: 'River Flow', 
                    cost: 300, 
                    type: 'river',
                    colors: ['#87CEEB', '#1E90FF'],
                    premium: false 
                }
            ],
            character: [
                { id: 'character1', name: 'Classic Bird', cost: 0, type: 'bird', premium: false },
                { id: 'character2', name: 'Salmon', cost: 600, type: 'salmon', premium: false },
                { id: 'character3', name: 'Tropical Fish', cost: 600, type: 'fish', premium: false },
                { id: 'character4', name: 'Santa Bird', cost: 750, type: 'santa', premium: true }
            ]
        };
        
        // Category titles
        const categoryTitles = {
            bird: "Bird Colors",
            pipe: "Pipe Colors", 
            background: "Backgrounds",
            character: "Characters"
        };
        
        // Initialize game
        function init() {
            canvas = document.getElementById('gameCanvas');
            ctx = canvas.getContext('2d');
            canvas.width = 360;
            canvas.height = 640;
            
            // Event listeners
            document.getElementById('startBtn').addEventListener('click', startGame);
            document.getElementById('shopBtn').addEventListener('click', showShop);
            document.getElementById('backBtn').addEventListener('click', hideShop);
            document.getElementById('restartBtn').addEventListener('click', restartGame);
            document.getElementById('menuBtn').addEventListener('click', showMenu);
            
            // Difficulty buttons
            document.querySelectorAll('.difficulty-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.difficulty-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentDifficulty = this.dataset.difficulty;
                    updateDifficulty();
                });
            });
            
            // Shop category buttons
            document.querySelectorAll('.category').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.category').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    const category = this.dataset.category;
                    showCategoryItems(category);
                    document.getElementById('shopCategoryTitle').textContent = categoryTitles[category];
                });
            });
            
            // Canvas click for bird jump
            canvas.addEventListener('click', function() {
                if (gameRunning) {
                    bird.velocity = bird.jump;
                }
            });
            
            // Keyboard controls
            document.addEventListener('keydown', function(e) {
                if (e.code === 'Space' && gameRunning) {
                    bird.velocity = bird.jump;
                }
            });
            
            // Initialize shop with bird category
            showCategoryItems('bird');
            updateCoinsDisplay();
        }
        
        // Update difficulty settings
        function updateDifficulty() {
            switch(currentDifficulty) {
                case 'easy':
                    gameSpeed = 1.5;
                    pipeGap = 200;
                    pipeInterval = 160;
                    bird.gravity = 0.4;
                    bird.jump = -7;
                    break;
                case 'medium':
                    gameSpeed = 2;
                    pipeGap = 170;
                    pipeInterval = 140;
                    bird.gravity = 0.5;
                    bird.jump = -8;
                    break;
                case 'hard':
                    gameSpeed = 2.5;
                    pipeGap = 140;
                    pipeInterval = 120;
                    bird.gravity = 0.6;
                    bird.jump = -9;
                    break;
            }
        }
        
        // Show purchase effect
        function showPurchaseEffect(itemName) {
            const effect = document.createElement('div');
            effect.className = 'purchase-effect';
            effect.textContent = `âœ“ Purchased: ${itemName}`;
            document.body.appendChild(effect);
            
            setTimeout(() => {
                if (effect.parentNode) {
                    effect.parentNode.removeChild(effect);
                }
            }, 2000);
        }
        
        // Show coin animation
        function showCoinAnimation(x, y, amount) {
            const coinAnim = document.createElement('div');
            coinAnim.className = 'coin-animation';
            coinAnim.textContent = `+${amount}`;
            coinAnim.style.left = x + 'px';
            coinAnim.style.top = y + 'px';
            document.querySelector('.game-container').appendChild(coinAnim);
            
            setTimeout(() => {
                if (coinAnim.parentNode) {
                    coinAnim.parentNode.removeChild(coinAnim);
                }
            }, 1500);
        }
        
        // Animate coin counter
        function animateCoinCounter(targetCoins) {
            const coinsDisplay = document.getElementById('coinsCount');
            const currentCoins = parseInt(coinsDisplay.textContent);
            
            if (currentCoins < targetCoins) {
                coinsDisplay.textContent = currentCoins + 1;
                coinsDisplay.style.animation = 'coinCount 0.2s ease';
                
                setTimeout(() => {
                    coinsDisplay.style.animation = '';
                    animateCoinCounter(targetCoins);
                }, 50);
            }
        }
        
        // Start game function
        function startGame() {
            document.getElementById('startScreen').classList.add('hidden');
            gameRunning = true;
            score = 0;
            bird.y = 150;
            bird.velocity = 0;
            pipes = [];
            frameCount = 0;
            coinsToAdd = 0;
            coinAnimationTimer = 0;
            
            updateScoreDisplay();
            gameLoop();
        }
        
        // Game loop
        function gameLoop() {
            if (!gameRunning) return;
            
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw background
            drawBackground();
            
            // Update and draw bird
            updateBird();
            drawBird();
            
            // Update and draw pipes
            updatePipes();
            drawPipes();
            
            // Update score and coins
            updateScore();
            
            // Check collision
            if (checkCollision()) {
                gameOver();
                return;
            }
            
            // Next frame
            requestAnimationFrame(gameLoop);
        }
        
        // Draw background based on selection
        function drawBackground() {
            const bg = shopItems.background.find(bg => bg.id === selectedItems.background);
            
            if (bg.type === 'sky') {
                // Sunny Day - Clear blue sky with clouds
                const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
                gradient.addColorStop(0, '#87CEEB');
                gradient.addColorStop(1, '#E0F7FA');
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // Sun
                ctx.fillStyle = '#FFD700';
                ctx.beginPath();
                ctx.arc(300, 80, 40, 0, Math.PI * 2);
                ctx.fill();
                
                // Clouds
                ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
                drawCloud(100, 120, 30);
                drawCloud(250, 80, 25);
                drawCloud(50, 180, 35);
            }
            else if (bg.type === 'field') {
                // Green Field - Clear field with horizon
                const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
                gradient.addColorStop(0, '#87CEEB');
                gradient.addColorStop(0.6, '#7CFC00');
                gradient.addColorStop(1, '#228B22');
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // Sun
                ctx.fillStyle = '#FFD700';
                ctx.beginPath();
                ctx.arc(300, 80, 40, 0, Math.PI * 2);
                ctx.fill();
            }
            else if (bg.type === 'night') {
                // Starry Night - Dark with stars
                const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
                gradient.addColorStop(0, '#0f1a30');
                gradient.addColorStop(1, '#1a237e');
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // Stars
                ctx.fillStyle = 'white';
                for (let i = 0; i < 50; i++) {
                    const x = (i * 73) % canvas.width;
                    const y = (i * 47) % (canvas.height / 2);
                    const size = Math.random() * 2 + 1;
                    ctx.fillRect(x, y, size, size);
                }
                
                // Moon
                ctx.fillStyle = '#f0f0f0';
                ctx.beginPath();
                ctx.arc(80, 80, 30, 0, Math.PI * 2);
                ctx.fill();
            }
            else if (bg.type === 'halloween') {
                // Spooky Halloween - Purple night with bats and pumpkins
                const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
                gradient.addColorStop(0, '#4B0082');
                gradient.addColorStop(1, '#8B0000');
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // Halloween moon
                ctx.fillStyle = '#FFA500';
                ctx.beginPath();
                ctx.arc(300, 80, 40, 0, Math.PI * 2);
                ctx.fill();
                
                // Bats
                ctx.fillStyle = 'black';
                for (let i = 0; i < 3; i++) {
                    const x = (frameCount * 2 + i * 100) % (canvas.width + 50) - 25;
                    const y = 150 + Math.sin(frameCount * 0.1 + i) * 20;
                    drawBat(x, y, 15);
                }
                
                // Pumpkins
                drawPumpkin(100, 500, 25);
                drawPumpkin(250, 520, 30);
            }
            else if (bg.type === 'christmas') {
                // Merry Christmas - Snowy scene with tree
                const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
                gradient.addColorStop(0, '#1E90FF');
                gradient.addColorStop(1, '#E1F5FE');
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // Snow
                ctx.fillStyle = 'white';
                for (let i = 0; i < 30; i++) {
                    const x = (i * 37) % canvas.width;
                    const y = (frameCount * 2 + i * 7) % canvas.height;
                    const size = Math.random() * 2 + 1;
                    ctx.fillRect(x, y, size, size);
                }
                
                // Christmas tree
                drawChristmasTree(180, 600, 100);
            }
            else if (bg.type === 'river') {
                // River Flow - Blue water scene
                const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
                gradient.addColorStop(0, '#87CEEB');
                gradient.addColorStop(0.5, '#1E90FF');
                gradient.addColorStop(1, '#0000CD');
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // River waves
                ctx.strokeStyle = '#0000CD';
                ctx.lineWidth = 2;
                for (let i = 0; i < 3; i++) {
                    ctx.beginPath();
                    const waveOffset = Math.sin(frameCount * 0.05 + i) * 10;
                    ctx.moveTo(0, canvas.height / 2 + i * 20 + waveOffset);
                    ctx.bezierCurveTo(
                        100, canvas.height / 2 + i * 20 + 10 + waveOffset,
                        200, canvas.height / 2 + i * 20 - 10 + waveOffset,
                        canvas.width, canvas.height / 2 + i * 20 + waveOffset
                    );
                    ctx.stroke();
                }
            }
        }
        
        // Helper drawing functions
        function drawCloud(x, y, size) {
            ctx.beginPath();
            ctx.arc(x, y, size, 0, Math.PI * 2);
            ctx.arc(x + size * 0.8, y - size * 0.2, size * 0.8, 0, Math.PI * 2);
            ctx.arc(x + size * 1.5, y, size, 0, Math.PI * 2);
            ctx.fill();
        }
        
        function drawBat(x, y, size) {
            ctx.beginPath();
            // Body
            ctx.ellipse(x, y, size/3, size/2, 0, 0, Math.PI * 2);
            // Wings
            ctx.moveTo(x - size/2, y);
            ctx.quadraticCurveTo(x, y - size, x + size/2, y);
            ctx.quadraticCurveTo(x, y + size, x - size/2, y);
            ctx.fill();
        }
        
        function drawPumpkin(x, y, size) {
            // Pumpkin body
            ctx.fillStyle = '#FF8C00';
            ctx.beginPath();
            ctx.ellipse(x, y, size, size * 1.3, 0, 0, Math.PI * 2);
            ctx.fill();
            
            // Pumpkin stem
            ctx.fillStyle = '#8B4513';
            ctx.fillRect(x - 3, y - size * 1.3, 6, 10);
            
            // Pumpkin face
            ctx.fillStyle = 'black';
            // Eyes
            ctx.beginPath();
            ctx.arc(x - size * 0.3, y - size * 0.2, size * 0.2, 0, Math.PI * 2);
            ctx.arc(x + size * 0.3, y - size * 0.2, size * 0.2, 0, Math.PI * 2);
            ctx.fill();
            // Mouth
            ctx.beginPath();
            ctx.arc(x, y + size * 0.3, size * 0.4, 0, Math.PI);
            ctx.fill();
        }
        
        function drawChristmasTree(x, y, height) {
            // Tree
            ctx.fillStyle = '#228B22';
            ctx.beginPath();
            ctx.moveTo(x, y - height);
            ctx.lineTo(x - height * 0.6, y);
            ctx.lineTo(x + height * 0.6, y);
            ctx.closePath();
            ctx.fill();
            
            // Trunk
            ctx.fillStyle = '#8B4513';
            ctx.fillRect(x - 10, y, 20, 30);
            
            // Decorations
            const decorations = ['#FF0000', '#FFD700', '#FFFFFF', '#0000FF'];
            for (let i = 0; i < 8; i++) {
                ctx.fillStyle = decorations[i % decorations.length];
                const decX = x - height * 0.4 + Math.random() * height * 0.8;
                const decY = y - height + Math.random() * height * 0.8;
                ctx.beginPath();
                ctx.arc(decX, decY, 4, 0, Math.PI * 2);
                ctx.fill();
            }
        }
        
        // Update bird position
        function updateBird() {
            bird.velocity += bird.gravity;
            bird.y += bird.velocity;
            
            // Boundary check
            if (bird.y - bird.height/2 < 0) {
                bird.y = bird.height/2;
                bird.velocity = 0;
            }
            
            if (bird.y + bird.height/2 > canvas.height) {
                bird.y = canvas.height - bird.height/2;
                gameOver();
            }
        }
        
        // Draw bird based on character selection
        function drawBird() {
            const character = shopItems.character.find(c => c.id === selectedItems.character);
            
            if (character.type === 'bird') {
                drawClassicBird();
            } else if (character.type === 'salmon') {
                drawSalmon();
            } else if (character.type === 'fish') {
                drawTropicalFish();
            } else if (character.type === 'santa') {
                drawSantaBird();
            }
        }
        
        function drawClassicBird() {
            const birdItem = shopItems.bird.find(b => b.id === selectedItems.bird);
            
            // Bird body with selected color
            if (birdItem.color.includes('gradient')) {
                const gradient = ctx.createLinearGradient(
                    bird.x - 20, bird.y - 15, 
                    bird.x + 20, bird.y + 15
                );
                gradient.addColorStop(0, '#FF5252');
                gradient.addColorStop(0.5, '#FFD700');
                gradient.addColorStop(1, '#4CAF50');
                ctx.fillStyle = gradient;
            } else {
                ctx.fillStyle = birdItem.color;
            }
            
            ctx.beginPath();
            ctx.ellipse(bird.x, bird.y, bird.width/2, bird.height/2, 0, 0, Math.PI * 2);
            ctx.fill();
            
            // Eye
            ctx.fillStyle = 'white';
            ctx.beginPath();
            ctx.arc(bird.x + 8, bird.y - 4, 6, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.fillStyle = 'black';
            ctx.beginPath();
            ctx.arc(bird.x + 9, bird.y - 4, 3, 0, Math.PI * 2);
            ctx.fill();
            
            // Beak
            ctx.fillStyle = '#FF5722';
            ctx.beginPath();
            ctx.moveTo(bird.x + 12, bird.y);
            ctx.lineTo(bird.x + 22, bird.y - 3);
            ctx.lineTo(bird.x + 22, bird.y + 3);
            ctx.closePath();
            ctx.fill();
        }
        
        function drawSalmon() {
            // Salmon body
            ctx.fillStyle = '#FF8C69';
            ctx.beginPath();
            ctx.ellipse(bird.x, bird.y, bird.width/2, bird.height/2, 0, 0, Math.PI * 2);
            ctx.fill();
            
            // Tail
            ctx.beginPath();
            ctx.moveTo(bird.x - 15, bird.y);
            ctx.lineTo(bird.x - 30, bird.y - 10);
            ctx.lineTo(bird.x - 30, bird.y + 10);
            ctx.closePath();
            ctx.fill();
            
            // Eye
            ctx.fillStyle = 'white';
            ctx.beginPath();
            ctx.arc(bird.x + 8, bird.y - 3, 4, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.fillStyle = 'black';
            ctx.beginPath();
            ctx.arc(bird.x + 9, bird.y - 3, 2, 0, Math.PI * 2);
            ctx.fill();
        }
        
        function drawTropicalFish() {
            // Fish body
            ctx.fillStyle = '#87CEEB';
            ctx.beginPath();
            ctx.ellipse(bird.x, bird.y, bird.width/2, bird.height/2, 0, 0, Math.PI * 2);
            ctx.fill();
            
            // Tail
            ctx.beginPath();
            ctx.moveTo(bird.x - 12, bird.y);
            ctx.lineTo(bird.x - 25, bird.y - 8);
            ctx.lineTo(bird.x - 25, bird.y + 8);
            ctx.closePath();
            ctx.fill();
            
            // Eye
            ctx.fillStyle = 'white';
            ctx.beginPath();
            ctx.arc(bird.x + 6, bird.y - 3, 4, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.fillStyle = 'black';
            ctx.beginPath();
            ctx.arc(bird.x + 7, bird.y - 3, 2, 0, Math.PI * 2);
            ctx.fill();
        }
        
        function drawSantaBird() {
            // Bird body
            ctx.fillStyle = '#8B4513';
            ctx.beginPath();
            ctx.ellipse(bird.x, bird.y, bird.width/2, bird.height/2, 0, 0, Math.PI * 2);
            ctx.fill();
            
            // Santa hat
            ctx.fillStyle = 'red';
            ctx.beginPath();
            ctx.moveTo(bird.x - 10, bird.y - 8);
            ctx.lineTo(bird.x + 15, bird.y - 8);
            ctx.lineTo(bird.x + 2, bird.y - 20);
            ctx.closePath();
            ctx.fill();
            
            // Hat pom-pom
            ctx.fillStyle = 'white';
            ctx.beginPath();
            ctx.arc(bird.x + 2, bird.y - 20, 4, 0, Math.PI * 2);
            ctx.fill();
            
            // Eye
            ctx.fillStyle = 'white';
            ctx.beginPath();
            ctx.arc(bird.x + 6, bird.y - 3, 4, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.fillStyle = 'black';
            ctx.beginPath();
            ctx.arc(bird.x + 7, bird.y - 3, 2, 0, Math.PI * 2);
            ctx.fill();
            
            // Beak
            ctx.fillStyle = '#FF5722';
            ctx.beginPath();
            ctx.moveTo(bird.x + 10, bird.y);
            ctx.lineTo(bird.x + 18, bird.y - 2);
            ctx.lineTo(bird.x + 18, bird.y + 2);
            ctx.closePath();
            ctx.fill();
        }
        
        // Update pipes
        function updatePipes() {
            // Create new pipes
            if (frameCount % pipeInterval === 0) {
                const pipeHeight = Math.floor(Math.random() * (canvas.height - pipeGap - 150)) + 75;
                pipes.push({
                    x: canvas.width,
                    y: 0,
                    width: pipeWidth,
                    height: pipeHeight,
                    passed: false
                });
                
                pipes.push({
                    x: canvas.width,
                    y: pipeHeight + pipeGap,
                    width: pipeWidth,
                    height: canvas.height - pipeHeight - pipeGap,
                    passed: false
                });
            }
            
            // Move pipes
            for (let i = 0; i < pipes.length; i++) {
                pipes[i].x -= gameSpeed;
                
                // Remove pipes that are off screen
                if (pipes[i].x + pipes[i].width < 0) {
                    pipes.splice(i, 1);
                    i--;
                }
            }
            
            frameCount++;
        }
        
        // Draw pipes
        function drawPipes() {
            const pipeItem = shopItems.pipe.find(p => p.id === selectedItems.pipe);
            
            for (let i = 0; i < pipes.length; i++) {
                // Pipe body with selected color
                if (pipeItem.color.includes('gradient')) {
                    const gradient = ctx.createLinearGradient(
                        pipes[i].x, pipes[i].y, 
                        pipes[i].x + pipes[i].width, pipes[i].y + pipes[i].height
                    );
                    gradient.addColorStop(0, '#FF5252');
                    gradient.addColorStop(0.5, '#FFD700');
                    gradient.addColorStop(1, '#4CAF50');
                    ctx.fillStyle = gradient;
                } else {
                    ctx.fillStyle = pipeItem.color;
                }
                
                ctx.fillRect(pipes[i].x, pipes[i].y, pipes[i].width, pipes[i].height);
                
                // Pipe caps
                ctx.fillStyle = pipeItem.premium ? '#E91E63' : '#388E3C';
                ctx.fillRect(pipes[i].x - 5, pipes[i].y, pipes[i].width + 10, 20);
                if (pipes[i].y > 0) {
                    ctx.fillRect(pipes[i].x - 5, pipes[i].y + pipes[i].height - 20, pipes[i].width + 10, 20);
                }
            }
        }
        
        // Update score and coins
        function updateScore() {
            for (let i = 0; i < pipes.length; i += 2) {
                if (!pipes[i].passed && pipes[i].x + pipes[i].width < bird.x) {
                    pipes[i].passed = true;
                    score++;
                    
                    // Add coins based on score
                    const coinsEarned = 1; // 1 coin per pipe
                    coinsToAdd += coinsEarned;
                    
                    // Show coin animation
                    if (coinAnimationTimer <= 0) {
                        showCoinAnimation(bird.x, bird.y, coinsEarned);
                        coinAnimationTimer = 10; // Reset timer
                    }
                    
                    updateScoreDisplay();
                }
            }
            
            // Add coins gradually
            if (coinsToAdd > 0 && coinAnimationTimer <= 0) {
                coins++;
                coinsToAdd--;
                updateCoinsDisplay();
            }
            
            if (coinAnimationTimer > 0) {
                coinAnimationTimer--;
            }
        }
        
        // Check collision
        function checkCollision() {
            // Bird collision box (smaller than visual)
            const birdLeft = bird.x - bird.width/2 + 5;
            const birdRight = bird.x + bird.width/2 - 5;
            const birdTop = bird.y - bird.height/2 + 5;
            const birdBottom = bird.y + bird.height/2 - 5;
            
            // Pipe collision
            for (let i = 0; i < pipes.length; i++) {
                const pipe = pipes[i];
                
                if (
                    birdRight > pipe.x &&
                    birdLeft < pipe.x + pipe.width &&
                    birdBottom > pipe.y &&
                    birdTop < pipe.y + pipe.height
                ) {
                    return true;
                }
            }
            
            return false;
        }
        
        // Game over
        function gameOver() {
            gameRunning = false;
            
            // Add remaining coins
            if (coinsToAdd > 0) {
                coins += coinsToAdd;
                coinsToAdd = 0;
                updateCoinsDisplay();
            }
            
            // Calculate bonus coins based on score
            const earnedCoins = Math.floor(score / 2);
            coins += earnedCoins;
            
            document.getElementById('finalScore').textContent = score;
            document.getElementById('coinsEarned').textContent = earnedCoins;
            document.getElementById('gameOverScreen').classList.remove('hidden');
            
            updateCoinsDisplay();
        }
        
        // Restart game
        function restartGame() {
            document.getElementById('gameOverScreen').classList.add('hidden');
            startGame();
        }
        
        // Show menu
        function showMenu() {
            document.getElementById('gameOverScreen').classList.add('hidden');
            document.getElementById('startScreen').classList.remove('hidden');
        }
        
        // Show shop
        function showShop() {
            document.getElementById('startScreen').classList.add('hidden');
            document.getElementById('shopScreen').classList.remove('hidden');
        }
        
        // Hide shop
        function hideShop() {
            document.getElementById('shopScreen').classList.add('hidden');
            document.getElementById('startScreen').classList.remove('hidden');
        }
        
        // Show category items in shop
        function showCategoryItems(category) {
            const itemsContainer = document.getElementById('itemsContainer');
            itemsContainer.innerHTML = '';
            
            shopItems[category].forEach(item => {
                const isOwned = ownedItems[category].includes(item.id);
                const isSelected = selectedItems[category] === item.id;
                const canAfford = coins >= item.cost || isOwned;
                
                const itemDiv = document.createElement('div');
                const itemClass = `item ${item.cost === 0 ? 'free' : ''} ${item.premium ? 'premium' : ''} ${isSelected ? 'selected' : ''} ${isOwned ? 'owned' : ''} ${!canAfford && !isOwned ? 'locked' : ''}`;
                itemDiv.className = itemClass;
                itemDiv.dataset.item = item.id;
                itemDiv.dataset.cost = item.cost;
                
                let itemContent = '';
                
                if (category === 'background') {
                    itemContent = `
                        <div class="background-preview" style="background: linear-gradient(${item.colors[0]}, ${item.colors[1]});">
                            ${item.premium ? '<div class="premium-badge">PREMIUM</div>' : ''}
                            ${isOwned ? '<div class="owned-badge">OWNED</div>' : ''}
                        </div>
                        <div class="item-name">${item.name}</div>
                        <div class="item-price ${item.cost === 0 ? 'free' : ''}">
                            ${isOwned ? 'OWNED' : item.cost === 0 ? 'Free' : `
                                <img class="coins-icon" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIj48cGF0aCBmaWxsPSIjRkZENzAwIiBkPSJNNDUyIDg0SDYwQzI2LjkgODQgMCAxMDAuOSAwIDEyNHYyNjRjMCAyMy4xIDI2LjkgNDAgNjAgNDBoMzkyYzMzLjEgMCA2MC0xNi45IDYwLTQwVjEyNGMwLTIzLjEtMjYuOS00MC02MC00MHpNMjU2IDQwOGMtNjYuMiAwLTEyMC00My44LTEyMC0xMDBzNTMuOC0xMDAgMTIwLTEwMCAxMjAgNDMuOCAxMjAgMTAwLTUzLjggMTAwLTEyMCAxMDB6bTAtMTYwYy0zMy4xIDAtNjAgMTYuOS02IA0KICA2MCA0MHMxNi45IDQwIDQwIDQwIDQwLTE2LjkgNDAtNDAtMTYuOS00MC00MC00MHoiLz48L3N2Zz4=" alt="Coin">
                                ${item.cost}
                            `}
                        </div>
                    `;
                } else if (category === 'character') {
                    itemContent = `
                        <div class="character-preview">
                            <div class="character-${item.type}"></div>
                            ${item.premium ? '<div class="premium-badge">PREMIUM</div>' : ''}
                            ${isOwned ? '<div class="owned-badge">OWNED</div>' : ''}
                        </div>
                        <div class="item-name">${item.name}</div>
                        <div class="item-price ${item.cost === 0 ? 'free' : ''}">
                            ${isOwned ? 'OWNED' : item.cost === 0 ? 'Free' : `
                                <img class="coins-icon" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIj48cGF0aCBmaWlsPSIjRkZENzAwIiBkPSJNNDUyIDg0SDYwQzI2LjkgODQgMCAxMDAuOSAwIDEyNHYyNjRjMCAyMy4xIDI2LjkgNDAgNjAgNDBoMzkyYzMzLjEgMCA2MC0xNi45IDYwLTQwVjEyNGMwLTIzLjEtMjYuOS00MC02MC00MHpNMjU2IDQwOGMtNjYuMiAwLTEyMC00My44LTEyMC0xMDBzNTMuOC0xMDAgMTIwLTEwMCAxMjAgNDMuOCAxMjAgMTAwLTUzLjggMTAwLTEyMCAxMDB6bTAtMTYwYy0zMy4xIDAtNjAgMTYuOS02IA0KICA2MCA0MHMxNi45IDQwIDQwIDQwIDQwLTE2LjkgNDAtNDAtMTYuOS00MC00MC00MHoiLz48L3N2Zz4=" alt="Coin">
                                ${item.cost}
                            `}
                        </div>
                    `;
                } else {
                    itemContent = `
                        <div class="item-color" style="background: ${item.color};">
                            ${isOwned ? '<div class="owned-badge">OWNED</div>' : ''}
                        </div>
                        <div class="item-name">${item.name}</div>
                        <div class="item-price ${item.cost === 0 ? 'free' : ''}">
                            ${isOwned ? 'OWNED' : item.cost === 0 ? 'Free' : `
                                <img class="coins-icon" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIj48cGF0aCBmaWxsPSIjRkZENzAwIiBkPSJNNDUyIDg0SDYwQzI2LjkgODQgMCAxMDAuOSAwIDEyNHYyNjRjMCAyMy4xIDI2LjkgNDAgNjAgNDBoMzkyYzMzLjEgMCA2MC0xNi45IDYwLTQwVjEyNGMwLTIzLjEtMjYuOS00MC02MC00MHpNMjU2IDQwOGMtNjYuMiAwLTEyMC00My44LTEyMC0xMDBzNTMuOC0xMDAgMTIwLTEwMCAxMjAgNDMuOCAxMjAgMTAwLTUzLjggMTAwLTEyMCAxMDB6bTAtMTYwYy0zMy4xIDAtNjAgMTYuOS02IA0KICA2MCA0MHMxNi45IDQwIDQwIDQwIDQwLTE2LjkgNDAtNDAtMTYuOS00MC00MC00MHoiLz48L3N2Zz4=" alt="Coin">
                                ${item.cost}
                            `}
                        </div>
                    `;
                }
                
                itemDiv.innerHTML = itemContent;
                
                itemDiv.addEventListener('click', function() {
                    if (this.classList.contains('locked')) return;
                    
                    const cost = parseInt(this.dataset.cost);
                    const isAlreadyOwned = ownedItems[category].includes(item.id);
                    
                    if (isAlreadyOwned) {
                        // Select owned item
                        document.querySelectorAll('.item').forEach(i => i.classList.remove('selected'));
                        this.classList.add('selected');
                        selectedItems[category] = item.id;
                    } else if (coins >= cost) {
                        // Purchase and select item
                        document.querySelectorAll('.item').forEach(i => i.classList.remove('selected'));
                        this.classList.add('selected');
                        selectedItems[category] = item.id;
                        ownedItems[category].push(item.id);
                        coins -= cost;
                        
                        // Show purchase effect
                        showPurchaseEffect(item.name);
                        
                        updateCoinsDisplay();
                        showCategoryItems(category); // Refresh to show owned status
                    } else {
                        alert('Not enough coins!');
                    }
                });
                
                itemsContainer.appendChild(itemDiv);
            });
        }
        
        // Update coins display
        function updateCoinsDisplay() {
            document.getElementById('coinsCount').textContent = coins;
        }
        
        // Update score display
        function updateScoreDisplay() {
            document.getElementById('scoreDisplay').textContent = `Score: ${score}`;
        }
        
        // Initialize the game when page loads
        window.onload = init;
    </script>
</body>
</html>